plugins {
    id 'com.android.application'
}

android {
    compileSdk 35
    namespace 'org.shano.assistral'
    android.buildFeatures.buildConfig true
    defaultConfig {
        applicationId "org.shano.assistral"
        minSdk 21
        targetSdk 35
        versionCode 320
        versionName project.findProperty("VERSION_NAME") ?: "3.2.0"
        
        // Set arch-specific version code
        project.ext.versionNameString = project.findProperty("VERSION_NAME") ?: "3.2.0"
    }

    signingConfigs {
        release {
            if (project.hasProperty("MYAPP_RELEASE_STORE_FILE")) {
                storeFile file(project.property("MYAPP_RELEASE_STORE_FILE"))
                storePassword project.property("MYAPP_RELEASE_STORE_PASSWORD")
                keyAlias project.property("MYAPP_RELEASE_KEY_ALIAS")
                keyPassword project.property("MYAPP_RELEASE_KEY_PASSWORD")
                println "ðŸ”‘ Using release signing config with keystore: ${project.property("MYAPP_RELEASE_STORE_FILE")}"
            } else {
                println "âŒ No signing properties found - APK will be unsigned"
            }
        }
    }

    buildTypes {
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
            // Only use signing config if properties are available
            if (project.hasProperty("MYAPP_RELEASE_STORE_FILE")) {
                signingConfig signingConfigs.release
            }
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    
    lint {
        disable "MissingTranslation" // Translation is crowd-sourced, so this lint warning is useless
        abortOnError false
    }
    
    // F-Droid compatibility - ensure reproducible builds
    applicationVariants.all { variant ->
        variant.outputs.all { output ->
            def versionName = project.ext.versionNameString
            outputFileName = "assistral-${variant.name}-${versionName}.apk"
        }
    }
}

dependencies {
   implementation 'androidx.webkit:webkit:1.12.1'
}
